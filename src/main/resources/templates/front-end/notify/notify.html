<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>客服中心</title>
    <!-- 引入 Bootstrap CSS 文件 -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
    
    <link href="https://cdn.jsdelivr.net/npm/paginationjs@2.6.0/dist/pagination.min.css" rel="stylesheet">
    <style>
        main {
            min-height: calc(100vh - 70px);
        }

        tbody tr {
          height: 95px;
          cursor: pointer;
        }

        tbody th {
          word-break: normal;
        } 

        .notify_class button {
          margin: 0 10px;
          border-radius: 5px;
          text-decoration: underline;
          text-underline-offset: 8px;
        }
    </style>
    
<script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.30.1/moment.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/paginationjs@2.6.0/dist/pagination.min.js"></script>
    
</head>

<body>

    <div class="container">
        <header class="d-flex flex-wrap align-items-center justify-content-center justify-content-md-between py-3 mb-4 border-bottom">
          <div class="col-md-3 mb-2 mb-md-0">
            <a href="index.html" class="d-inline-flex link-body-emphasis text-decoration-none">
              <span class="fs-4">做伙</span>
            </a>
          </div>
    
          <ul class="nav col-12 col-md-auto mb-2 justify-content-center mb-md-0">
            <li><a href="index.html" class="nav-link px-2 link-secondary">首頁</a></li>
            <li><a href="join.html" class="nav-link px-2 link-secondary">瀏覽活動</a></li>
            <li><a href="create.html" class="nav-link px-2 link-secondary">舉辦活動</a></li>
            <li><a href="rent.html" class="nav-link px-2 link-secondary">場地租借</a></li>
            <li><a href="customer.html" class="nav-link px-2 link-secondary">FAQs</a></li>
            <li><a href="about.html" class="nav-link px-2 link-secondary">關於我們</a></li>
          </ul>
    
          <div class="col-md-3 text-end">
            <button type="button" class="btn btn-outline-primary me-2"><a class="nav-link" href="#" data-bs-toggle="modal" data-bs-target="#loginModal">登入</a></button>
            <button type="button" class="btn btn-primary"><a class="nav-link" href="register.html">註冊</a></button>
          </div>
          <h6 id="memId" th:text="${session.memId}" ></h6>
        </header>
      </div>

    <main class="container mt-5">
        <section id="customer-service" class="mt-5">
            <h2>通知訊息</h2>
    
            <ul id="city-tab" class="nav nav-tabs">
			    <li id="city-a" data-notifytitle="全部通知" class="nav-item"><a class="nav-link active"
			        aria-current="page" href="#">全部通知</a></li>
			    <li id="city-b" data-notifytitle="一般通知" class="nav-item"><a class="nav-link active" href="#">一般通知</a></li>
			    <li id="city-b" data-notifytitle="活動通知" class="nav-item"><a class="nav-link active" href="#">活動通知</a></li>
			    <li id="city-b" data-notifytitle="場地通知" class="nav-item"><a class="nav-link active" href="#">場地通知</a></li>
			    <li id="city-b" data-notifytitle="系統通知" class="nav-item"><a class="nav-link active" href="#">系統通知</a></li>
			</ul>
			
            <section id="faq">
                <div id="notify-block" class="container">
                        <table id="notify-table" class="table table-striped table table-hover">
                        
	                        <thead>
	                          <tr>
	                            <th scope="col" style="width: 15%">類別</th>
	                            <th scope="col" style="width: 65%">訊息</th>
	                            <th scope="col">時間</th>
	                          </tr>
	                        </thead>
	                        
	                        <tbody id="notify-items">
	                            <!-- 資料庫資料 -->
	                            <!-- 資料庫資料 -->
	                            <!-- 資料庫資料 -->
	                        </tbody>
                        
                      </table>
                </div>
            </section>
        </section>

    </main>

    <div class="container">
        <footer class="py-3 my-4">
          <ul class="nav justify-content-center border-bottom pb-3 mb-3">
            <li class="nav-item"><a href="index.html" class="nav-link px-2 text-muted">首頁</a></li>
            <li class="nav-item"><a href="customer.html" class="nav-link px-2 text-muted">客服中心</a></li>
            <li class="nav-item"><a href="about.html" class="nav-link px-2 text-muted">關於我們</a></li>
          </ul>
          <p class="text-center text-muted">© 2023 Company, Inc</p>
        </footer>
    </div>

    <!-- 引入 Bootstrap JavaScript 文件 -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL"
        crossorigin="anonymous"></script>

    <!-- 登入選項的Modal 彈窗 -->
    <div class="modal fade" id="loginModal" tabindex="-1" aria-labelledby="loginModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="loginModalLabel">會員登入</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <!-- 在這裡加入登入表單的 HTML 代碼 -->
                    <form>
                        <!-- 登入表單的輸入欄位 -->
                        <div class="mb-3">
                            <label for="username" class="form-label">帳號：</label>
                            <input type="text" class="form-control" id="username" name="username" placeholder="輸入您的帳號" required>
                        </div>
                        <div class="mb-3">
                            <label for="password" class="form-label">密碼：</label>
                            <div class="input-group">
                                <input type="password" class="form-control" id="password" name="password"
                                    placeholder="輸入您的密碼" required>
                                <!-- 在密碼輸入框右上方新增"忘記密碼"的連結 -->
                                <a href="#" class="input-group-text" id="forgotPasswordLink">忘記密碼</a>
                            </div>
                        </div>
                        <!-- 登入按鈕 -->
                        <button type="submit" class="btn btn-primary">登入</button>
                    </form>
                </div>
            </div>
        </div>
    </div>





<script th:inline="javascript">
    /*<![CDATA[*/
    let user = /*[[${session.memId}]]*/'';
    /*]]>*/
    /*<![CDATA[*/
    let notifies = /*[[${session.notifies}]]*/'';
    /*]]>*/
</script>

<script>

//確保 DOM 內容已加載
$(document).ready(async function(){

	await readAll(user);
    await getNotifyByMemId(user);
    getMemNotify(notifies);

});
    
    
	async function readAll(id){
	    await fetch("/front_end/notify/readAll",{
	        method: "POST",
	        body: JSON.stringify({memId: id})
	    }).then(function(response){;
	        return response.json();
	    }).then(function(getAllMemNotifies){  
	        
	    }).catch(function(err){
	        console.log(err);
	    }); 
	}   
	
	
	async function getNotifyByMemId(id){
	    await fetch("/front_end/notify/memberNotify",{
	        method: "POST",
	        body: JSON.stringify({memId: id})
	    }).then(function(response){;
	        return response.json();
	    }).then(function(getAllMemNotifies){  
	        
	        notifies = getAllMemNotifies;
	        
	    }).catch(function(err){
	        console.log(err);
	    }); 
	}
	
	
	// 印出全部通知
	function getMemNotify(notes){
		
		$('#notify-block').pagination({
		    dataSource: notes,
		    pageSize: 5,
		    showSizeChanger: true,
		    callback: function(notes, pagination){
		    	  if(!notes.length) {
		    		  console.log("123");
		    	  }else{
			    	  $("#notify-items").html("");
			    		  console.log(notes);
			    	  for(let notify of notes){
			            $("#notify-items").append(
			                `<tr id="this_notify">
			                <th>${notify.notifyTitle}</th>
			                <td>${notify.notifyContent}</td>
			                <td>${moment(notify.notifyTime).format('YYYY-MM-DD HH:mm:ss')}</td>
			                </tr>`);
			          }
		    	  }
		    }
        });
    }
    
	
	// 印出全部通知
	function getAllNotify(){
		getMemNotify(notifies);
    }
	
	// 印出一般通知
	function getNormalNotify(){
        let filteredNotifies = notifies.filter(notify => notify.notifyTitle == "一般通知");
        getMemNotify(filteredNotifies);
    }
	
	// 印出活動通知
	function getActNotify(){
        let filteredNotifies = notifies.filter(notify => notify.notifyTitle == "活動通知");
        getMemNotify(filteredNotifies);
    }
	
	// 印出場地通知
	function getVenNotify(){
        let filteredNotifies = notifies.filter(notify => notify.notifyTitle == "場地通知");
        getMemNotify(filteredNotifies);
    }
	
	// 印出系統通知
	function getSystemNotify(){
        let filteredNotifies = notifies.filter(notify => notify.notifyTitle == "系統通知");
        getMemNotify(filteredNotifies);
    }
	
	
		$("#city-tab li").on("click", async function(){
	        let title = $(this).data("notifytitle");
	        getNotifyByMemId(user);
	        switch (title) {
	            case "全部通知":
	                await getAllNotify();
	                break;
	            case "一般通知":
	                await getNormalNotify();
	                break;
	            case "活動通知":
	                await getActNotify();
	                break;
	            case "場地通知":
	                await getVenNotify();
	                break;
	            case "系統通知":
	                await getSystemNotify();
	                break;
	        }
	        return false;
		});
	
	
	
	
// 	async function getNotifyByMemId(id){
//         await fetch("/front_end/notify/memberNotify",{
//             method: "POST",
//             body: JSON.stringify({memId: id})
//         }).then(function(response){;
//             return response.json();
//         }).then(function(notifies){  
//             // 清除清單內容
//             $("#notify-items").html("");
//            
//             for(let notify of notifies){
//                 $("#notify-items").append(
//                     `<tr id="this_notify">
//                     <th>${notify.notifyTitle}</th>
//                     <td>${notify.notifyContent}</td>
//                     <td>${moment(notify.notifyTime).format('YYYY-MM-DD HH:mm:ss')}</td>
//                     </tr>`);
//             }
//            
//         }).catch(function(err){
//             console.log(err);
//         }); 
//     }
//	
//     await getNotifyByMemId(memId);
	
    // fetch 是一個非同步函數所以需要使用 await
//     async function getNotifyByTitle(notifyTitle){
//         await fetch("/front_end/notify/notifyTitle",{
//             method: "POST",
//             body: JSON.stringify({notifyTitle: notifyTitle})
//         }).then(function(response){;
//             return response.json();
//         }).then(function(notifies){     
//             // 清除清單內容
//             $("#notify-items").html("");
//            
//             for(let notify of notifies){
//             	if(memId == `${notify.membershipVO.memId}`){
//            	
//             	$("#notify-items").append(
// 					`<tr id="this_notify">
// 					<th>${notify.notifyTitle}</th>
// 					<td>${notify.notifyContent}</td>
// 					<td>${moment(notify.notifyTime).format('YYYY-MM-DD HH:mm:ss')}</td>
// 					</tr>`);
//             	}
//             }
//         }).catch(function(err){
//             console.log(err);
//         }); 
//     }

    
    


</script>


</body>

</html>